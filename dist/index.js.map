{"version":3,"sources":["../src/index.js"],"names":["commandListener","notify","level","message","details","options","dismissable","detail","inkdrop","notifications","checkForUpdates","force","stdout","packages","getIpmPath","input","data","JSON","parse","split","length","pluginsStr","namesArr","map","item","name","firstNames","slice","lastName","namesStr","join","err","console","error","activate","commands","add","document","body","isMainWindow","deactivate","dispose"],"mappings":";;;;;;;;AAAA;;;;AAEA,IAAIA,eAAe,GAAG,IAAtB;;AAEA,SAASC,MAAT,CAAgBC,KAAhB,EAAuBC,OAAvB,EAAgCC,OAAhC,EAAyC;AACvC,QAAMC,OAAO,GAAG;AACdC,IAAAA,WAAW,EAAE;AADC,GAAhB;;AAIA,MAAI,OAAOF,OAAP,KAAmB,QAAvB,EAAiC;AAC/BC,IAAAA,OAAO,CAACE,MAAR,GAAiBH,OAAjB;AACD;;AAEDI,EAAAA,OAAO,CAACC,aAAR,CAAuB,MAAKP,KAAM,EAAlC,EAAqCC,OAArC,EAA8CE,OAA9C;AACD;;AAED,eAAeK,eAAf,CAA+BC,KAA/B,EAAsC;AACpC,MAAI;AACF,UAAM;AAAEC,MAAAA;AAAF,QAAa,MAAM,oBACvBJ,OAAO,CAACK,QAAR,CAAiBC,UAAjB,EADuB,EAEvB,CAAC,QAAD,EAAW,QAAX,CAFuB,EAGvB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAHuB,CAAzB;AAMA,UAAMC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWN,MAAM,CAACO,KAAP,CAAa,IAAb,EAAmB,CAAnB,CAAX,CAAb;;AAEA,QAAIH,IAAI,CAACI,MAAL,KAAgB,CAApB,EAAuB;AACrB,UAAIT,KAAJ,EAAW;AACTV,QAAAA,MAAM,CAAC,SAAD,EAAY,6BAAZ,CAAN;AACD;;AAED;AACD;;AAED,UAAMoB,UAAU,GAAI,SAAQL,IAAI,CAACI,MAAL,GAAc,CAAd,GAAkB,GAAlB,GAAwB,EAAG,EAAvD;AAEA,UAAME,QAAQ,GAAGN,IAAI,CAACO,GAAL,CAASC,IAAI,IAAIA,IAAI,CAACC,IAAtB,CAAjB;AACA,UAAMC,UAAU,GAAGJ,QAAQ,CAACK,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAnB,CAAnB;AACA,UAAMC,QAAQ,GAAGN,QAAQ,CAACA,QAAQ,CAACF,MAAT,GAAkB,CAAnB,CAAzB;AACA,UAAMS,QAAQ,GAAI,GAAEH,UAAU,CAACI,IAAX,CAAgB,IAAhB,CAAsB,QAAOF,QAAS,EAA1D;AAEA,UAAMzB,OAAO,GAAI,4CAA2Ca,IAAI,CAACI,MAAO,aAAYC,UAAW,GAA/F;AACA,UAAMjB,OAAO,GAAI,YAAWiB,UAAW,KAAIQ,QAAS,GAApD;AAEA5B,IAAAA,MAAM,CAAC,MAAD,EAASE,OAAT,EAAkBC,OAAlB,CAAN;AACD,GA5BD,CA4BE,OAAO2B,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,KAAR,CAAc,oCAAd,EAAoDF,GAApD;;AAEA,QAAIpB,KAAJ,EAAW;AACTV,MAAAA,MAAM,CAAC,OAAD,EAAW,uCAAsC8B,GAAG,CAAC5B,OAAQ,EAA7D,CAAN;AACD;AACF;AACF;;AAEM,SAAS+B,QAAT,GAAoB;AACzBlC,EAAAA,eAAe,GAAGQ,OAAO,CAAC2B,QAAR,CAAiBC,GAAjB,CAAqBC,QAAQ,CAACC,IAA9B,EAAoC;AACpD,4BAAwB,MAAM5B,eAAe,CAAC,IAAD;AADO,GAApC,CAAlB;;AAIA,MAAIF,OAAO,CAAC+B,YAAZ,EAA0B;AACxB7B,IAAAA,eAAe,CAAC,KAAD,CAAf;AACD;AACF;;AAEM,SAAS8B,UAAT,GAAsB;AAC3B,MAAIxC,eAAe,KAAK,IAAxB,EAA8B;AAC5BA,IAAAA,eAAe,CAACyC,OAAhB;AACAzC,IAAAA,eAAe,GAAG,IAAlB;AACD;AACF","sourcesContent":["import execa from 'execa';\n\nlet commandListener = null;\n\nfunction notify(level, message, details) {\n  const options = {\n    dismissable: true,\n  };\n\n  if (typeof details === 'string') {\n    options.detail = details;\n  }\n\n  inkdrop.notifications[`add${level}`](message, options);\n}\n\nasync function checkForUpdates(force) {\n  try {\n    const { stdout } = await execa(\n      inkdrop.packages.getIpmPath(),\n      ['update', '--json'],\n      { input: 'no' },\n    );\n\n    const data = JSON.parse(stdout.split('\\n')[0]);\n\n    if (data.length === 0) {\n      if (force) {\n        notify('Success', 'All plugins are up-to-date.');\n      }\n\n      return;\n    }\n\n    const pluginsStr = `plugin${data.length > 1 ? 's' : ''}`;\n\n    const namesArr = data.map(item => item.name);\n    const firstNames = namesArr.slice(0, -1);\n    const lastName = namesArr[namesArr.length - 1];\n    const namesStr = `${firstNames.join(', ')} and ${lastName}`;\n\n    const message = `Run 'ipm update' in a terminal to update ${data.length} outdated ${pluginsStr}.`;\n    const details = `Outdated ${pluginsStr}: ${namesStr}.`;\n\n    notify('Info', message, details);\n  } catch (err) {\n    console.error('Could not check for plugin updates', err);\n\n    if (force) {\n      notify('Error', `Could not check for plugin updates: ${err.message}`);\n    }\n  }\n}\n\nexport function activate() {\n  commandListener = inkdrop.commands.add(document.body, {\n    'update-checker:check': () => checkForUpdates(true),\n  });\n\n  if (inkdrop.isMainWindow) {\n    checkForUpdates(false);\n  }\n}\n\nexport function deactivate() {\n  if (commandListener !== null) {\n    commandListener.dispose();\n    commandListener = null;\n  }\n}\n"],"file":"index.js"}